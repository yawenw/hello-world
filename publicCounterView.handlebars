

<!--Main Layout-->
<main style="padding-top: 50px">
   <div class="container-fluid">
      <div class="row align-items-center col-lg-12 justify-content-center col-centered collapse multi-collapse" id="collapseInput">
         <div class=" col-lg-7">
            <div class="form-inline">
            <h3 class="devATitle">Counter Lookup Tool</h3>&nbsp&nbsp <a type="button" href="#" onclick="modalAction(event,'Card title',this)" data-target="#fullHeightModal" style="font-family:helvetica;margin-bottom: 10px" data-toggle="tooltip" data-placement="right" title="Quick-Start Guide"><img src="/images/help26x26.png"></a>
            </div>
            <br>
            <br>

            <div class="dropdown">
              <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Select Module
                <span class="caret"></span></button>
                <ul class="dropdown-menu pre-scrollable">
                  <li><a type = "button" href="#" onclick="selectModule('AAA')">AAA</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('APPFLOW')">APPFLOW</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('APPFW')">APPFW</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('APPQOE')">APPQOE</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('CACHE REDIRECTION')">CACHE REDIRECTION</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('CLUSTER')">CLUSTER</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('COMPRESSION')">COMPRESSION</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('CONTENT ACCELERATOR')">CONTENT ACCELERATOR</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('CS')">CS</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('DNS')">DNS</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('GSLB')">GSLB</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('HA')">HA</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('HDOSP')">HDOSP</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('HTML INJECTION')">HTML INJECTION</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('HTTP')">HTTP</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('ICMP')">ICMP</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('INTEGRATED CACHE')">INTEGRATED CACHE</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('IPV6')">IPV6</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('LOAD BALANCING')">LOAD BALANCING</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('MISCELLANEOUS')">MISCELLANEOUS</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('NETWORKING')">NETWORKING</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('NIC')">NIC</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('POLICY_APPEXPERT')">POLICY_APPEXPERT</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('PRIORITY QUEUING')">PRIORITY QUEUING</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('SERVICES')">SERVICES</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('SNMP')">SNMP</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('SSL')">SSL</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('SSLVPN')">SSLVPN</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('SURE CONNECT')">SURE CONNECT</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('SYSTEM')">SYSTEM</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('TCP')">TCP</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('UDP')">UDP</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('VLAN')">VLAN</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('VPATH')">VPATH</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('VSERVER')">VSERVER</a></li>
                  <li><a type = "button" href="#" onclick="selectModule('WEB LOGGING')">WEB LOGGING</a></li>
		  <li><a type = "button" href="#" onclick="selectModule('ALL')">ALL</a></li>
                </ul>
              </div>
            <div autocomplete="off">
	      <br/>
              <h5 class="devATitle">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<b>OR</b></h5>
	      <div class="autocomplete form-inline md-form mr-auto mb-4">
            	<img class="mr-sm-2" src="/images/search-icon.png" style="height: auto;max-width: 25%;" class="img-fluid">
               <label class="devAFont" for="case">&nbsp&nbsp&nbsp&nbsp&nbspSearch by counter or module</label>
               <input onfocus="toggleFocus()" id="counterSearchBox" class="form-control col-lg-7 col-sm-5 mr-sm-2" type="text"  aria-label="Search">
               <button class="btn btn-outline-primary btn-sm my-0 gen_btn devATitle" id="searchButton">Start Search</button>
               </div>
            </div>
          </div>
         <div class=""><br><br><br><br><br><br><br>

            <br><br><br>
         </div>
         <div class="" id="progressBar">
            <div class="indeterminate"></div>
         </div>
      </div>
      <div class="row align-items-center justify-content-center" style="padding-top: 0px">

         <div class="col-centered col-lg-11" style="padding-top: 0px">
            <br>
            <div class="collapse multi-collapse" id="collapseOutput" style="padding-top: 0px">
               <!-- First Step -->
               <div class="row">
                <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10">
                  <h3 class="devATitle" id="formTitle"><strong>Summary</strong></h3>
                  <button type="button" class="btn btn-outline-primary" onclick="JSONToExcelConvertor(rawJsonResponse,searchValue)">Export Search Results</button>
                </div>
                <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2">
                  <h5 class="devATitle">Rows Per Page</h5>
                <nav id="RowNumNav" style="" aria-label="Page navigation example"">
                  <ul class="pagination pg-blue">
                          <li class="page-item" id="ItemNum_5" onclick="RefreshItemNumInPage(5)"><a class = "page-link" href="#" >5</a></li>
                          <li class="page-item active" id="ItemNum_10" onclick="RefreshItemNumInPage(10)"><a class = "page-link" href="#" >10</a></li>
                          <li class="page-item" id="ItemNum_15" onclick="RefreshItemNumInPage(15)"><a class = "page-link" href="#">15</a></li>
                          <li class="page-item" id="ItemNum_20"  onclick="RefreshItemNumInPage(20)"><a class = "page-link" href="#">20</a></li>
                  </ul>
                </nav>
              </div>
                </div>
				       <div class="row">
                 <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4"></div>
                 <div>
                   <nav id="paginationNav"  aria-label="Page navigation example" ></nav>
                 </div>
               </div>
               <form role="form" action="" method="post" id="resultForm">

               </form>
                <div class="row">
                  <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4"></div>
                  <div>
                    <nav id="paginationNavB" aria-label="Page navigation example" ></nav>
                  </div>
                </div>
               <button class="btn btn-outline-primary btn-md my-0 devATitle hoverable sticky" data-spy="affix" data-toggle="collapse" aria-expanded="false" aria-controls="collapseOutput collapseInput" data-target=".multi-collapse" id="toggleButton" style="display:none"><strong></strong></button><br><br><br>
            </div>
         </div>
      </div>
   </div>

   <!-- Full Height Modal Right -->
<div class="modal fade right" id="fullHeightModal" tabindex="-1" role="dialog" data-backdrop="true" aria-labelledby="myRightModalLabel" aria-hidden="true">

    <!-- Add class .modal-full-height and then add class .modal-right (or other classes from list above) to set a position to the modal -->
    <div class="modal-dialog modal-full-height modal-right" id="principalModal" role="document">


      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title w-100 text-center" id="myRightModalLabel">Modal title</h4>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="modalBody">
          <h3>Test Title</h3><br>

"Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem. Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur? Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur?"
        </div>
        <div class="modal-footer justify-content-center">
          <button type="button" class="btn btn-blue" data-dismiss="modal" >Close</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Full Height Modal Right -->

</main>
<script>
  var rawJsonResponse;
  var paginationBoxes;
  var currentPage = 1;
  var tableType;
  var rowsPerPage = 10;
   function modalAction(e,appName, obj){
  e.preventDefault();   // if you want to not go to href url uncoment this
  obj.setAttribute("data-toggle", "modal");
  var principalModal = document.getElementById("principalModal");
  var fullHeightModal = document.getElementById("fullHeightModal");
  var modalBody = document.getElementById("modalBody");

  modalBody.innerHTML = '<br>'+
      '<ul class="list-group">'+
      '<li class="list-group-item"><span class="badge badge-primary badge-pill">1</span>&nbsp&nbsp&nbspThere are two options to see counters :<br/><b>i.</b> See the counters belonging to Module from drop down "SELECT MODULE"<br/><b>ii.</b> On the search field either enter a counter or a module name.<br/><font size="2">*Modules will be listed again when you start typing them for better use in search field.<br/>*When you get prompted the autocomplete layout for Modules on search field, you can either click on them to select one or you can navigate over the layout using the down arrow and up arrow keys, then click enter to select one module.</font></li>'+
      '<li class="list-group-item"><span class="badge badge-primary badge-pill">2</span>&nbsp&nbsp&nbspThe website will automatically displays the result of the search. You can download the search result by clicking on the "Export Search Results"</li>'+
      '<li class="list-group-item"><span class="badge badge-primary badge-pill">3</span>&nbsp&nbsp&nbspIn case of mutiple counters you can choose number of counters to be displayed per page under Rows Per Page.</li>'+
      '<li class="list-group-item"><span class="badge badge-primary badge-pill">4</span>&nbsp&nbsp&nbspIf you want to start a new search, press the backspace key on your keyboard or go to the bottom of the results page, and click "New Search"</li>'+
'<li class="list-group-item"><span class="badge badge-primary badge-pill">5</span>&nbsp&nbsp&nbspFor Any Questions or Feedback: <a href="https://www.citrix.com/en-in/contact/technical-support.html"> <img src="/images/support36x36.png"></a></li>'+
      '<br><br>';
    };
  document.getElementById("myRightModalLabel").innerHTML= "Counter Lookup Tool <br/> Quick-Start Guide";
  var onAutoComplete = false;
  document.getElementById("counterSearchBox").addEventListener("keydown", function(e) {
    if (e.keyCode == 13 && !onAutoComplete) {
      document.getElementById("searchButton").click();
    }
  });

  document.getElementById("searchButton").addEventListener("click", function(e) {
    onAutoComplete = false;
  });
  function autocomplete(inp, arr) {
  /*the autocomplete function takes two arguments,
  the text field element and an array of possible autocompleted values:*/
  var currentFocus;
  /*execute a function when someone writes in the text field:*/
  inp.addEventListener("input", function(e) {
      var a, b, i, val = this.value;
      /*close any already open lists of autocompleted values*/
      closeAllLists();
      if (!val) { return false;}
      currentFocus = -1;
      /*create a DIV element that will contain the items (values):*/
      a = document.createElement("DIV");
      a.setAttribute("id", this.id + "autocomplete-list");
      a.setAttribute("class", "autocomplete-items");

      /*append the DIV element as a child of the autocomplete container:*/
      this.parentNode.appendChild(a);
      /*for each item in the array...*/
      for (i = 0; i < arr.length; i++) {
        /*check if the item starts with the same letters as the text field value:*/
        if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
          /*create a DIV element for each matching element:*/
          b = document.createElement("DIV");
          b.setAttribute("class", "devASubTitle");
          /*make the matching letters bold:*/
          b.innerHTML = "<strong style='color:black;font-weight: bold;'>" + arr[i].substr(0, val.length) + "</strong>";
          b.innerHTML += arr[i].substr(val.length);
          /*insert a input field that will hold the current array item's value:*/
          b.innerHTML += "<input id='choosenValue' type='hidden' value='" + arr[i] + "'>";
          /*execute a function when someone clicks on the item value (DIV element):*/
          b.addEventListener("click", function(e) {
              /*insert the value for the autocomplete text field:*/
              inp.value = this.getElementsByTagName("input")[0].value;
              /*close the list of autocompleted values,
              (or any other open lists of autocompleted values:*/
              closeAllLists();
              onAutoComplete = false;
          });
          a.appendChild(b);
        }
      }
  });
  /*execute a function presses a key on the keyboard:*/
  inp.addEventListener("keydown", function(e) {
      var x = document.getElementById(this.id + "autocomplete-list");
      if (x) x = x.getElementsByTagName("div");
      if (e.keyCode == 40) {
        onAutoComplete = true;
        /*If the arrow DOWN key is pressed,
        increase the currentFocus variable:*/
        currentFocus++;
        /*and and make the current item more visible:*/
        addActive(x);
      } else if (e.keyCode == 38) { //up
        /*If the arrow UP key is pressed,
        decrease the currentFocus variable:*/
        currentFocus--;
        /*and and make the current item more visible:*/
        addActive(x);
      } else if (e.keyCode == 13) {
        /*If the ENTER key is pressed, prevent the form from being submitted,*/

        e.preventDefault();
        if (currentFocus > -1) {
          /*and simulate a click on the "active" item:*/
          if (x) x[currentFocus].click();
        }
      }
  });
  function addActive(x) {
    /*a function to classify an item as "active":*/
    if (!x) return false;
    /*start by removing the "active" class on all items:*/
    removeActive(x);
    if (currentFocus >= x.length) currentFocus = 0;
    if (currentFocus < 0) currentFocus = (x.length - 1);
    /*add class "autocomplete-active":*/
    x[currentFocus].classList.add("autocomplete-active");
  }
  function removeActive(x) {
    /*a function to remove the "active" class from all autocomplete items:*/
    for (var i = 0; i < x.length; i++) {
      x[i].classList.remove("autocomplete-active");
    }
  }
  function closeAllLists(elmnt) {
    /*close all autocomplete lists in the document,
    except the one passed as an argument:*/
    var x = document.getElementsByClassName("autocomplete-items");
    for (var i = 0; i < x.length; i++) {
      if (elmnt != x[i] && elmnt != inp) {
        x[i].parentNode.removeChild(x[i]);
      }
    }
  }
  /*execute a function when someone clicks in the document:*/
  document.addEventListener("click", function (e) {
      closeAllLists(e.target);
  });
}
  var componentsArray = ["AAA","APPFLOW","APPFW","APPQOE","CACHE REDIRECTION","CLUSTER","COMPRESSION","CONTENT ACCELERATOR","CS","DNS","GSLB","HA","HDOSP","HTML INJECTION","HTTP","ICMP","INTEGRATED CACHE","IPV6","LOAD BALANCING","MISCELLANEOUS","NETWORKING","NIC","POLICY_APPEXPERT","PRIORITY QUEUING","SERVICES","SNMP","SSL","SSLVPN","SURE CONNECT","SYSTEM","TCP","UDP","VLAN","VPATH","VSERVER","WEB LOGGING","ALL"];

  /*initiate the autocomplete function on the "myInput" element, and pass along the componentsArray array as possible autocomplete values:*/
  autocomplete(document.getElementById("counterSearchBox"), componentsArray);
	var resultForm = document.getElementById("resultForm");
	var formTitle = document.getElementById("formTitle");
  var searchValue = "";
  var boxOnFocus = false;
  function toggleFocus(){
    if(boxOnFocus)
      boxOnFocus=false;
    else
      boxOnFocus=true;
  }
  $(document).ready(function(){
   $('#collapseOutput').on('show.bs.collapse', function () {
     //when new search is supposed to happen
     $('#collapseInput').collapse('hide');
     document.getElementById("toggleButton").innerHTML = "New Search";
     document.getElementById("toggleButton").style.position = "fixed";
     document.getElementById("toggleButton").style.bottom = "20px";
     document.getElementById("toggleButton").style.right = "20px";

   })
   $('#collapseInput').collapse('show');
   $('#collapseInput').on('show.bs.collapse', function () {
     //when results are shown
     document.getElementById("toggleButton").style.display = "none";
     document.getElementById("toggleButton").innerHTML = "";
     clearFields();
   })

   document.addEventListener("keydown", function (e) {
     if (e.keyCode == 8 && document.getElementById("toggleButton").innerHTML == 'New Search')  {
       document.getElementById("toggleButton").click();
     }
   });
      $(".gen_btn").click(function(){
       searchValue = document.getElementById("counterSearchBox").value;
       if(searchValue == "")
         toastr.error('Error: Please fill out the search field');
       else{
	for(i=0;i<searchValue.length;i++)
         {
           charcode = searchValue.charCodeAt(i);
           if( !( (charcode == 32) /*space*/
             ||  (charcode == 95) /*'_'*/
             ||  (charcode >= 97 && charcode <=122) /*a~z*/
             ||  (charcode >= 65 && charcode <=90) /*A~Z*/
             ||  (charcode >= 48 && charcode <=57) /*0~9*/)
            )
            {
               toastr.error('Error: The input string can only contains digits, letters, spaces, underscores.');
               return;
            }
         }
         document.getElementById("searchButton").setAttribute("disabled", "");
         $("#progressBar").addClass('progress');
         $("#progressBar").addClass('md-progress');
         $("#progressBar").addClass('primary-color-dark');//*/
         while(searchValue.charAt(0)=== " "){
           searchValue = searchValue.substr(1);
         }

         if (componentsArray.includes(searchValue)){
           var xhttp = new XMLHttpRequest();
           xhttp.onreadystatechange = function() {
             if (this.readyState == 4 && this.status == 200) {
               displayResults("component",JSON.parse(this.response));
             }else if (this.readyState == 4 && this.status != 200){
               toastr.error('No component/module matches found on our database, reach support if needed');
               console.log('No component/module matches found on our database, reach support if needed, STATUS: '+this.status);
               $("#progressBar").removeClass('progress');
               $("#progressBar").removeClass('md-progress');
               $("#progressBar").removeClass('primary-color-dark');
             }
           };
           xhttp.open("GET", "/api/counterview/getCounterByComponent/"+searchValue, true);
           xhttp.send();
         }
     else{
               var yhttp = new XMLHttpRequest();
               yhttp.onreadystatechange = function() {
                 if (this.readyState == 4 && this.status == 200) {
                   displayResults("counter",JSON.parse(this.response));
                 }
                 else if (this.readyState == 4 && this.status == 500){
                   toastr.error('No matches found, please contact Citrix Technical Support if needed.');
                   $("#progressBar").removeClass('progress');
                   $("#progressBar").removeClass('md-progress');
                   $("#progressBar").removeClass('primary-color-dark');
                   }
                 };
               yhttp.open("GET", "/api/counterview/getCounterByName/"+searchValue, true);
               yhttp.send();
          }



         document.getElementById("searchButton").removeAttribute("disabled");
       }

      });
  });
   // Tooltips Initialization
   $(function () {
     $('[data-toggle="tooltip"]').tooltip()
   })

   function displayResults(type,jsonResponse){
    rawJsonResponse = jsonResponse;
   	if(type == 'component' || type == 'counter'){
      resultForm.innerHTML = '<div style="padding-top: 0px">'+
      '<div  id="tableDiv">'+
      '</div></div>';

      var tableDiv = document.getElementById("tableDiv");
      formTitle.innerHTML = '<strong>Searching for: '+searchValue+'</strong>';
      $("#tableDiv").addClass('col-md-12');
                tableDiv.innerHTML = '<table class="table-responsive table table-hover">'+
                '<thead>'+
                  '<tr>'+
                      '<th scope="col" style="color:#747373">#</th>'+
                      '<th scope="col" style="color:#747373">Name</th>'+
                      '<th scope="col" style="color:#747373">Description</th>'+
                      '<th scope="col" style="color:#747373">Component</th>'+
                      '<th scope="col" style="color:#747373">Supported Releases</th>'+
                      '<th scope="col" style="color:#747373">SNMP Name</th>'+
                  '</tr>'+
                '</thead>'+
                '<tbody id="tableBody">'+
                '</tbody>'+
            '</table>';

    }
    tableType = type;
    createTable();
  	toastr.info('Click on the "New Search" button at the bottom-right corner to find a new counter');
    backendSuccess();
    createPagination(currentPage);
    if(document.getElementById("paginationNav").innerHTML.length > 1){
      document.getElementById("pageBoxPage1").click();
    }
  };

  function createTable(){
    var tableBodyString = '';
    var jsonResponse = rawJsonResponse;
    //console.log(jsonResponse);
    var numberOfRows = jsonResponse.length;
    var startJsonIndex;
    var endJsonIndex;
    if(numberOfRows >= rowsPerPage){
      startJsonIndex = currentPage * rowsPerPage - rowsPerPage;
      endJsonIndex = (currentPage * rowsPerPage -1) < numberOfRows ? (currentPage * rowsPerPage -1) : numberOfRows-1;
      /*console.log(endJsonIndex+ " endJsonIndex");
      console.log(currentPage+" Current Page");
      console.log(numberOfRows+" Amount of counters");*/
    }else{
      startJsonIndex = 0;
      endJsonIndex = numberOfRows-1;
    }

    if(tableType == "component" || tableType == "counter"){
      for (var resultRow = startJsonIndex; resultRow <= endJsonIndex; resultRow++){
          tableBodyString += '<tr>'+
              '<th scope="row">'+(resultRow+1)+'</th>'+
              '<td>'+jsonResponse[resultRow]["name"]+'</td>'+
              '<td>'+jsonResponse[resultRow]["description"]+'</td>'+
              '<td>'+jsonResponse[resultRow]["component"]+'</td>'+
              '<td>'+jsonResponse[resultRow]["supportedReleases"]+'</td>'+
              '<td>'+jsonResponse[resultRow]["snmpName"]+'</td>'+
          '</tr>';
      }
    }else{
      for (var resultRow = startJsonIndex; resultRow <= endJsonIndex; resultRow++){
        tableBodyString += '<tr>'+
          '<th scope="row">'+(resultRow+1)+'</th>'+
          '<td>'+jsonResponse[resultRow]["name"]+'</td>'+
          '<td>'+jsonResponse[resultRow]["description"]+'</td>'+
          '</tr>';
      }
    }
    //console.log(tableBodyString);
    document.getElementById("tableBody").innerHTML = tableBodyString;
  }
/**
 * 导出excel
 * @param {Object} title  标题列key-val
 * @param {Object} data   值列key-val
 * @param {Object} fileName  文件名称
 */
function JSONToExcelConvertor(jsonfile, fileName) {

 var CSV = '';
 var row = "";
 console.log(jsonfile);
 var title=['#','name','description','component','supportedReleases','snmpName'];
 for (var i = 0; i < title.length; i++) {
  if(title[i]){
   row += title[i]+ ',';
  }
 }
 row = row.slice(0, -1);
 CSV += row + '\r\n';

 for (var i = 0; i < jsonfile.length; i++) {
  var row = ""+(i+1)+',';
  for (var j = 1; j < title.length; j++) {
   if(title[j]){
    row += '"' + (jsonfile[i][title[j]] ? jsonfile[i][title[j]] : "") + '"\t,';
   }
  }
  row.slice(0, row.length - 1);
  CSV += row + '\r\n';
 }

 if (CSV == '') {
  alert("Invalid data");
  return;
 }

 var fileName = fileName;
 var uri = new Blob(['\ufeff' + CSV], {type:"text/csv"});
 var link = document.createElement("a");
 link.href = URL.createObjectURL(uri);

 link.style = "visibility:hidden";
 link.download = fileName + ".csv";
 document.body.appendChild(link);
 link.click();
 document.body.removeChild(link);
}
  function RefreshItemNumInPage(ItemNum)
  {
    console.log(ItemNum);
    oldItemNum = rowsPerPage;
    rowsPerPage = ItemNum;

    document.getElementById("ItemNum_"+oldItemNum).setAttribute("class","page-item")
    document.getElementById("ItemNum_"+ItemNum).setAttribute("class","page-item active")
    currentPage = 1;
    createPagination(currentPage);
    createTable();
  }
   function selectModule(module_name){
       console.log(module_name);
       searchValue = module_name;
       if(searchValue == "")
         toastr.error('Error: Please fill out the search field');
       else{
         document.getElementById("searchButton").setAttribute("disabled", "");
         $("#progressBar").addClass('progress');
         $("#progressBar").addClass('md-progress');
         $("#progressBar").addClass('primary-color-dark');//*/
         while(searchValue.charAt(0)=== " "){
           searchValue = searchValue.substr(1);
         }

         if (componentsArray.includes(searchValue)){
           var xhttp = new XMLHttpRequest();
           xhttp.onreadystatechange = function() {
             if (this.readyState == 4 && this.status == 200) {
               displayResults("component",JSON.parse(this.response));
             }else if (this.readyState == 4 && this.status != 200){
               toastr.error('No component/module matches found on our database, reach support if needed');
               console.log('No component/module matches found on our database, reach support if needed, STATUS: '+this.status);
               $("#progressBar").removeClass('progress');
               $("#progressBar").removeClass('md-progress');
               $("#progressBar").removeClass('primary-color-dark');
             }
           };
           xhttp.open("GET", "/api/counterview/getCounterByComponent/"+searchValue, true);
           xhttp.send();
         }
     else{
               var yhttp = new XMLHttpRequest();
               yhttp.onreadystatechange = function() {
                 if (this.readyState == 4 && this.status == 200) {
                   displayResults("counter",JSON.parse(this.response));
                 }
                 else if (this.readyState == 4 && this.status == 500){
                   toastr.error('No matches found, please contact Citrix Technical Support if needed.');
                   $("#progressBar").removeClass('progress');
                   $("#progressBar").removeClass('md-progress');
                   $("#progressBar").removeClass('primary-color-dark');
                   }
                 };
               yhttp.open("GET", "/api/counterview/getCounterByName/"+searchValue, true);
               yhttp.send();
          }



         document.getElementById("searchButton").removeAttribute("disabled");
       }

    }
   function backendSuccess(){
   		//toastr.success('Match found.');
	   	$("#progressBar").removeClass('progress');
		$("#progressBar").removeClass('md-progress');
		$("#progressBar").removeClass('primary-color-dark');
		document.getElementById("toggleButton").click();
		document.getElementById("toggleButton").style.display = "block";
   }

   function clearFields(){
   		resultForm.innerHTML = "";
      document.getElementById("paginationNav").innerHTML = "";
	  document.getElementById("paginationNavB").innerHTML = "";

   }

   function createPaginationA(currentPageIndex){

     var NavigationHTML = '<ul class="pagination pg-blue">'+
     '<li class="page-item "><a class="page-link" id="pageBoxPage1" ><<</a></li><li class="page-item "><a class="page-link" id="pageBoxPrevious" >Previous</a></li>';
     var count = 1;
     paginationBoxes = (rawJsonResponse.length%rowsPerPage) > 0 ? ((rawJsonResponse.length-(rawJsonResponse.length%rowsPerPage))/rowsPerPage)+1 : Math.round(rawJsonResponse.length/rowsPerPage);
     if(currentPageIndex == 1 || currentPageIndex == 2 || currentPageIndex == 3)
       startIndex = 1;
     else if(currentPageIndex == paginationBoxes)
       startIndex = currentPageIndex-4;
     else if (currentPageIndex == paginationBoxes-1)
       startIndex = currentPageIndex-3;
     else
       startIndex = currentPageIndex-2;
     for (var i = startIndex; i <= paginationBoxes; i++){
       if (i==currentPage)
         NavigationHTML+= '<li class="page-item active"><a id="pageBox'+i+'" class="page-link">'+i+'</a></li>';
       else
         NavigationHTML+= '<li class="page-item"><a id="pageBox'+i+'" class="page-link">'+i+'</a></li>';
       if(count==5)
         break;
       count++;
     }
     NavigationHTML += '<li class="page-item"><a class="page-link" id="pageBoxNext">Next</a></li><li class="page-item"><a class="page-link" id="pageBoxLastOne">>></a></li></ul>';
     NavigationHTML = paginationBoxes == 1 ? "" : NavigationHTML;
     document.getElementById("paginationNav").innerHTML = NavigationHTML;
   }
   function createPaginationB(currentPageIndex){
     var NavigationHTML = '<ul class="pagination pg-blue">'+
     '<li class="page-item "><a class="page-link" id="pageBoxPageB1" ><<</a></li><li class="page-item "><a class="page-link" id="pageBoxPreviousB" >Previous</a></li>';
     var count = 1;
     paginationBoxes = (rawJsonResponse.length%rowsPerPage) > 0 ? ((rawJsonResponse.length-(rawJsonResponse.length%rowsPerPage))/rowsPerPage)+1 : Math.round(rawJsonResponse.length/rowsPerPage);
     if(currentPageIndex == 1 || currentPageIndex == 2 || currentPageIndex == 3)
       startIndex = 1;
     else if(currentPageIndex == paginationBoxes)
       startIndex = currentPageIndex-4;
     else if (currentPageIndex == paginationBoxes-1)
       startIndex = currentPageIndex-3;
     else
       startIndex = currentPageIndex-2;
     for (var i = startIndex; i <= paginationBoxes; i++){
       if (i==currentPage)
         NavigationHTML+= '<li class="page-item active"><a id="pageBoxB'+i+'" class="page-link">'+i+'</a></li>';
       else
         NavigationHTML+= '<li class="page-item"><a id="pageBoxB'+i+'" class="page-link">'+i+'</a></li>';
       if(count==5)
         break;
       count++;
     }
     NavigationHTML += '<li class="page-item"><a class="page-link" id="pageBoxNextB">Next</a></li><li class="page-item"><a class="page-link" id="pageBoxLastOneB">>></a></li></ul>';
     NavigationHTML = paginationBoxes == 1 ? "" : NavigationHTML;
     document.getElementById("paginationNavB").innerHTML = NavigationHTML;

   }
   function createPagination(currentPageIndex){

    createPaginationA(currentPageIndex);
    createPaginationB(currentPageIndex);
    if(paginationBoxes>1){
      paginationEvents(startIndex);
    }
   }

   function paginationEvents(startIndex){
    var count = 1;
    for(var i = startIndex; i <= paginationBoxes; i++){
      document.getElementById("pageBox"+i).addEventListener("click", function(e) {
          var id = this.id.replace("pageBox","");
          //console.log("lbl"+id);
          //console.log(document.getElementById("txt"+id).textContent);
          currentPage = parseInt(id);
          createPagination(currentPage);
          createTable();
        });
	document.getElementById("pageBoxB"+i).addEventListener("click", function(e) {
          var id = this.id.replace("pageBoxB","");
          //console.log("lbl"+id);
          //console.log(document.getElementById("txt"+id).textContent);
          currentPage = parseInt(id);
          createPagination(currentPage);
          createTable();
        });
      if(count==5)
        break;
      count++;
    }
    document.getElementById("pageBoxPrevious").addEventListener("click", function(e) {
          //console.log("lbl"+id);
          //console.log(document.getElementById("txt"+id).textContent);
          currentPage = currentPage-1;
          if(currentPage == 0)
            currentPage = 1;
          createPagination(currentPage);
          createTable();
        });
	document.getElementById("pageBoxPreviousB").addEventListener("click", function(e) {
          //console.log("lbl"+id);
          //console.log(document.getElementById("txt"+id).textContent);
          currentPage = currentPage-1;
          if(currentPage == 0)
            currentPage = 1;
          createPagination(currentPage);
          createTable();
        });

    document.getElementById("pageBoxNext").addEventListener("click", function(e) {
          //console.log("lbl"+id);
          //console.log(document.getElementById("txt"+id).textContent);
          currentPage = currentPage +1;
          if(currentPage >= paginationBoxes)
            currentPage = paginationBoxes;
          createPagination(currentPage);
          createTable();
        });
	document.getElementById("pageBoxNextB").addEventListener("click", function(e) {
          //console.log("lbl"+id);
          //console.log(document.getElementById("txt"+id).textContent);
          currentPage = currentPage +1;
          if(currentPage >= paginationBoxes)
            currentPage = paginationBoxes;
          createPagination(currentPage);
          createTable();
        });
    document.getElementById("pageBoxPage1").addEventListener("click", function(e) {
          //console.log("lbl"+id);
          //console.log(document.getElementById("txt"+id).textContent);
          currentPage = 1;
          createPagination(currentPage);
          createTable();
        });
	document.getElementById("pageBoxPageB1").addEventListener("click", function(e) {
          //console.log("lbl"+id);
          //console.log(document.getElementById("txt"+id).textContent);
          currentPage = 1;
          createPagination(currentPage);
          createTable();
        });
    document.getElementById("pageBoxLastOne").addEventListener("click", function(e) {
          //console.log("lbl"+id);
          //console.log(document.getElementById("txt"+id).textContent);
          currentPage = paginationBoxes;
          createPagination(currentPage);
          createTable();
        });
	document.getElementById("pageBoxLastOneB").addEventListener("click", function(e) {
          //console.log("lbl"+id);
          //console.log(document.getElementById("txt"+id).textContent);
          currentPage = paginationBoxes;
          createPagination(currentPage);
          createTable();
        });


   }

</script>
